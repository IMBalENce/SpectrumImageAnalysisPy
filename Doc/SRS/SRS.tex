\documentclass[12pt]{article}

\usepackage{amsmath, mathtools}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{colortbl}
\usepackage{xr}
\usepackage{hyperref}
\usepackage{longtable}
\usepackage{xfrac}
\usepackage{tabularx}
\usepackage{float}
\usepackage{siunitx}
\usepackage{booktabs}
\usepackage{caption}
\usepackage{pdflscape}
\usepackage{afterpage}

%\usepackage{refcheck}

\hypersetup{
    bookmarks=true,         % show bookmarks bar?
      colorlinks=true,       % false: boxed links; true: colored links
    linkcolor=red,          % color of internal links (change box color with linkbordercolor)
    citecolor=green,        % color of links to bibliography
    filecolor=magenta,      % color of file links
    urlcolor=cyan           % color of external links
}

\input{../Comments}

% For easy change of table widths
\newcommand{\colZwidth}{1.0\textwidth}
\newcommand{\colAwidth}{0.13\textwidth}
\newcommand{\colBwidth}{0.82\textwidth}
\newcommand{\colCwidth}{0.1\textwidth}
\newcommand{\colDwidth}{0.05\textwidth}
\newcommand{\colEwidth}{0.8\textwidth}
\newcommand{\colFwidth}{0.17\textwidth}
\newcommand{\colGwidth}{0.5\textwidth}
\newcommand{\colHwidth}{0.28\textwidth}

% Used so that cross-references have a meaningful prefix
\newcounter{defnum} %Definition Number
\newcommand{\dthedefnum}{GD\thedefnum}
\newcommand{\dref}[1]{GD\ref{#1}}
\newcounter{datadefnum} %Datadefinition Number
\newcommand{\ddthedatadefnum}{DD\thedatadefnum}
\newcommand{\ddref}[1]{DD\ref{#1}}
\newcounter{theorynum} %Theory Number
\newcommand{\tthetheorynum}{T\thetheorynum}
\newcommand{\tref}[1]{T\ref{#1}}
\newcounter{tablenum} %Table Number
\newcommand{\tbthetablenum}{T\thetablenum}
\newcommand{\tbref}[1]{TB\ref{#1}}
\newcounter{assumpnum} %Assumption Number
\newcommand{\atheassumpnum}{P\theassumpnum}
\newcommand{\aref}[1]{A\ref{#1}}
\newcounter{goalnum} %Goal Number
\newcommand{\gthegoalnum}{P\thegoalnum}
\newcommand{\gsref}[1]{GS\ref{#1}}
\newcounter{instnum} %Instance Number
\newcommand{\itheinstnum}{IM\theinstnum}
\newcommand{\iref}[1]{IM\ref{#1}}
\newcounter{reqnum} %Requirement Number
\newcommand{\rthereqnum}{P\thereqnum}
\newcommand{\rref}[1]{R\ref{#1}}
\newcounter{lcnum} %Likely change number
\newcommand{\lthelcnum}{LC\thelcnum}
\newcommand{\lcref}[1]{LC\ref{#1}}

\newcommand{\progname}{SpectrumImageAnalysisPy} % PUT YOUR PROGRAM NAME HERE

\usepackage{fullpage}

\begin{document}
\bibliographystyle{ieeetr}
\title{SpectrumImageAnalysisPy} 
\author{Isobel Bicket}
\date{\today}
	
\maketitle

~\newpage

\pagenumbering{roman}


\section{Revision History}

\begin{tabularx}{\textwidth}{p{4cm}p{2cm}X}
	\toprule {\bf Date} & {\bf Version} & {\bf Notes}\\
	\midrule
	\today & 1.0 & First draft\\
	\bottomrule
\end{tabularx}

~\newpage

\tableofcontents

\section{Reference Material}

This section contains reference information to enable the reader to better understand the document.

\subsection{Table of Units}

Throughout this document the system of units standard to the field of electron microscopy is used
as the unit system, for consistency with relevant literature and practices. For each unit, the symbol is given followed by a
description of the quantity described by the symbol and the unit name.
~\newline

\renewcommand{\arraystretch}{1.2}
%\begin{table}[ht]
  \noindent \begin{tabular}{l l l} 
    \toprule		
    \textbf{symbol} & \textbf{quantity} & \textbf{unit name}\\
    \midrule 
    \si{\nano\metre} & length & nanometre\\
    \si{\electronvolt} & energy	& electron volt\\
    \bottomrule
  \end{tabular}
  %	\caption{Provide a caption}
%\end{table}

\subsection{Table of Symbols}

The table that follows summarizes the symbols used in this document along with
their units. The symbols are listed in alphabetical order.

\renewcommand{\arraystretch}{1.2}
%\noindent \begin{tabularx}{1.0\textwidth}{l l X}
\noindent \begin{longtable*}{l l p{12cm}} \toprule
\textbf{symbol} & \textbf{unit} & \textbf{description}\\
\midrule 
$I$ & counts & Intensity\\
$b(k)$ & counts & Background signal on a detector\\
$g(k)$ & None & Gain value at each pixel\\
$k$ & None & pixel index\\
$N(k)$ & counts & Noise signal from the detector\\
$S(k)$ & counts & Signal entering the detector\\
$\zeta(k)$ & counts & Signal at each pixel as read out by a detector\\
\bottomrule
\end{longtable*}

\subsection{Abbreviations and Acronyms}

\renewcommand{\arraystretch}{1.2}
\begin{tabular}{l l} 
  \toprule		
  \textbf{symbol} & \textbf{description}\\
  \midrule 
  3D & Three-dimensions\\
  A & Assumption\\
  CCD & Charge-Coupled Device\\
  CL & Cathodoluminescence Spectroscopy\\
  DD & Data Definition\\
  EELS & Electron Energy Loss\\
  EELS & Electron Energy Loss Spectroscopy\\
  GD & General Definition\\
  GS & Goal Statement\\
  IM & Instance Model\\
  LC & Likely Change\\
  PS & Physical System Description\\
  PSF & Point Spread Function\\
  R & Requirement\\
  SI & Spectrum Image\\
  SRS & Software Requirements Specification\\
  STEM & Scanning Transmission Electron Microscope\\
  SEM & Scanning Electron Microscope\\
  \progname{} & SpectrumImageAnalysisPy\\
  T & Theoretical Model\\
  \bottomrule
\end{tabular}\\

\newpage
\pagenumbering{arabic}

\section{Introduction}
Three-dimensional datasets are produced by many spectro-microscopy techniques: techniques in which the response of a sample is mapped in two spatial domains and one spectral dimension. The visualization of 3D spectro-microscopy datasets is a challenging and often non-intuitive task. The motivation behind this software is to enable easy visualization and navigation through a 3D dataset to discover the features of the sample in both spatial and spectral domains. The data processing methods of 3D datasets are not trivial to perform and require a dedicated software designed to handle 3D data. This document provides the Software Requirements Specification (SRS) for a software designed to visualize and process 3D spectro-microscopy datasets derived from electron energy loss spectroscopy or cathodoluminescence.

\subsection{Purpose of Document}

This document details the requirements of the software \progname{}. The responsibilities of the user and software are laid out and the requirements that the software must satisfy are explicitly detailed.

\subsection{Scope of Requirements} 
The scope of the requirements for the software \progname{} is limited to the import; removal of instrumentation artifacts; visualization and navigation through; and the export of EELS and CL spectrum imaging data.

\subsection{Characteristics of Intended Reader} 
The reader of this document should have an understanding of spectrum imaging techniques, particularly EELS and the data processing methods used to remove effects of the acquisition system from the data acquired. A basic knowledge of convolution theory will be helpful to the reader and an understanding of the characteristics of 3D datasets. The reader should understand EELS and CL, as relevant to the sections of the document.

\subsection{Organization of Document}

The document follows the organizational scheme laid out by Smith \textit{et al} \cite{SmithAndLai2005, smith_requirements_2007}, starting with general reference material for the reader. The introduction of the document details the purpose of the document and intended reader, and is followed by the General System Description. The Specific System Description reduces the problem under consideration to a set of clearly defined definitions and models. The Requirements section of the document clearly outlines both the Functional and Non-functional requirements that the software must comply with. Finally, the document contains a list of Likely Changes to the software and Traceability matrices and graphs.

\section{General System Description}

This section identifies the interfaces between the system and its environment,
describes the user characteristics and lists the system constraints.

\subsection{System Context}

Use of the software \progname{} infers the following responsibilities on the part of the user, and confers the following responsibilities from the program.

\begin{itemize}
	\item User Responsibilities:
	\begin{itemize}
		\item Provide the correct input data to the program;
		\item Be capable of interacting with the software via a mouse and keyboard;
		\item Have the necessary dependencies for the program installed;
		\item Possess sufficient knowledge on what processing steps need to be performed and be able to judge that the quality of the output data is sufficient for the application, or change the processing steps performed;
	\end{itemize}
	\item \progname{} Responsibilities:
	\begin{itemize}
		\item Read inputs (either files or data arrays) and check the inputs for the correct data type and size
		\item Display the data and graphical user interface for the user to interact with
		\item Respond to user commands as appropriate, including visualization and data processing commands
		\item Export data in the correct file format(s)
	\end{itemize}
\end{itemize}

\subsection{User Characteristics} \label{SecUserCharacteristics}

The end user of \progname{} should be familiar with the concept of a spectrum
image and an understanding of what the data represents and the appropriate
actions needed to process spectrum images and extract useful information. A basic familiarity with programming is expected. An
understanding of the spectro-microscopy technique (CL or EELS) used to generate the data will
be beneficial, but is not strictly required. 

\subsection{System Constraints}

The software must be able to read .dm3 files for EELS data import, and .h5 files for CL data import to be able to interface with output from the data acquisition software.

\section{Specific System Description}

This section first presents the problem description, which gives a high-level
view of what the program is expected to do. The solution characteristics specification follows, detailing the assumptions that the software will make; the theoretical models the data analysis is based on; definitions for the types of data that the software must be able to process; and the instance models, which detail the data processing algorithms that the software will implement.

\subsection{Problem Description} \label{Sec_pd}

\progname{} is a software to allow users to import, process, navigate, and export spectrum image data. 

\subsubsection{Terminology and  Definitions}

This subsection provides a list of terms that are used in the subsequent
sections and their meaning, with the purpose of reducing ambiguity and making it
easier to correctly understand the requirements:

\begin{itemize}
	\item Cathodoluminescence: a technique in a STEM or SEM in which light emitted from the sample is collected by a mirror and directed to a spectrometer or other analysis system;
	\item Charge-Coupled Device: the camera used in the spectrometer to collect signal and output to the microscope acquisition software;
	\item Electron energy loss spectroscopy: a technique performed in a TEM or STEM which detects the energy lost by an electron beam after passing through a sample;
	\item Spectrum Image: a 3D dataset with two spatial dimensions and one spectral dimension, obtained using spectro-microscopy techniques (\textit{i.e.}, EELS or CL);
	\item Point Spread Function (PSF): a function representing the spreading in the spectrometer, as defined in \ddref{PSF};
	\item Spectrometer: an instrument attached to a microscope and equipped with a CCD or equivalent camera;
	\item Scanning electron microscope: a microscope which uses an electron beam to probe the sample and acquires data based on scattering off the surface or near the surface of the sample, operating using a raster scan of the electron beam;
	\item Scanning transmission electron microscope: a TEM with the capability of scanning the electron beam in a raster scan over the sample;
	\item Transmission electron microscope: a microscope which uses an electron beam to probe a sample and collects the signal of the transmitted beam;
	\item Sample: a physical sample of scientific interest that has been probed by the beam in the EELS or CL instrument. 
\end{itemize}

\subsubsection{Physical System Description}

The physical system that the program is concerned with the analysis of includes the following elements:

\begin{itemize}
	\item[PS1:] Sample under study.
	\item[PS2:] STEM equipped with EEL spectrometer.
	\item[PS3:] SEM or STEM equipped with CL collection system.
\end{itemize}

\subsubsection{Goal Statements}

\noindent Given a spectrum image dataset collected by either EELS or CL and a desire to visualize and process this dataset, the goal statements for \progname{} are:

\begin{itemize}
	\item[GS\refstepcounter{goalnum}\thegoalnum \label{G_ImportDisplay}:] Import a 3D dataset and display it such that the user can interact with it and navigate all three dimensions
	\item[GS\refstepcounter{goalnum}\thegoalnum \label{G_Processing}:] Provide processing options including: normalization and deconvolution for EELS SI; normalization and background subtraction for a CL SI
	\item[GS\refstepcounter{goalnum}\thegoalnum \label{G_Extraction}:] Extract slices from the dataset as desired by the user and communicated through the user interface, export these as desired by the user
\end{itemize}

\subsection{Solution Characteristics Specification}

The instance models that govern \progname{} are presented in
Subsection~\ref{sec_instance}.  The information to understand the meaning of the
instance models and their derivation is also presented, so that the instance
models can be verified.

\subsubsection{Assumptions}

This section simplifies the original problem and helps in developing the
theoretical model by filling in the missing information for the physical
system. The numbers given in the square brackets refer to the theoretical model
[T], general definition [GD], data definition [DD], instance model [IM], or
likely change [LC], in which the respective assumption is used.

\begin{itemize}

	\item[A\refstepcounter{assumpnum}\theassumpnum \label{EELS_System_Response}:] The EELS data can be described as the convolution of the ``real'' spectrum of the sample with the response of the microscope and spectrometer system function. The microscope and spectrometer system typically causes broadening in the peaks of the ``real'' spectrum;
	
	\item[A\refstepcounter{assumpnum}\theassumpnum \label{EELS_PSF_variability}:] The same PSF is valid for all pixels in the EELS spectrum image;
	
	\item[A\refstepcounter{assumpnum}\theassumpnum \label{EELS_Intensity_Fluctuations}:] Fluctuations in the intensity of the EELS signal are due to changes in the beam current as collected by the spectrometer;
	
	\item[A\refstepcounter{assumpnum}\theassumpnum \label{CL_Background}:] A subtraction is sufficient remove the contributions of the dark signal and the substrate signal from the CL sample signal;
	
	\item[A\refstepcounter{assumpnum}\theassumpnum \label{CL_System_Response}:] The CL spectrometer wavelength sensitivity can be accurately modelled by experimental reference data.

\end{itemize}

\subsubsection{Theoretical Models}\label{sec_theoretical}

This section focuses on the general equations and laws underlie the data acquisition process on a camera, providing the motivation for the data processing models that \progname  will implement.

~\newline

\noindent
\begin{minipage}{\textwidth}
	\renewcommand*{\arraystretch}{1.5}
	\begin{tabular}{| p{\colAwidth} | p{\colBwidth}|}
		  \hline
		  \rowcolor[gray]{0.9}
		  Number& T\refstepcounter{theorynum}\thetheorynum \label{intensity}\\
		  \hline
		  Label&\bf Intensity \\
		  \hline
		  Equation& $\zeta(k) = g(k) S(k) + b(k) + N(k)$ \\
		  \hline
		  Description & The signal, $\zeta(k)$ (\tref{signal}), obtained from each pixel, $k$, on the CCD detector can be considered as a sum of several different contributions: 
		  \begin{itemize}
			\item the signal obtained from the microscope $S(k)$, which is multiplied by the gain factor $g(k)$ of the pixel; 
			\item the background signal of each pixel $b(k)$; 
			\item and the noise present at each pixel $N(k)$.
		  \end{itemize}\\
		  \hline
		  Source & \cite{zuo_electron_2000}\\
		  \hline
		  Ref.\ By & \ddref{PSF} \\
		  \hline
	\end{tabular}
\end{minipage}\\

%T2
~\newline

\noindent
\begin{minipage}{\textwidth}
	\renewcommand*{\arraystretch}{1.5}
	\begin{tabular}{| p{\colAwidth} | p{\colBwidth}|}
		  \hline
		  \rowcolor[gray]{0.9}
		  Number& T\refstepcounter{theorynum}\thetheorynum \label{signal}\\
		  \hline
		  Label&\bf Signal \\
		  \hline
		  Equation& $S(k)=\int_{pixel}d\rho \lfloor \int f(\rho') h(\rho, \rho') d\rho' \rfloor$ \\
		  & $ S(k)=\sum_{k'} f(k') h(k, k')$\\
		  \hline
		  Description & The signal ($S(k)$) from the microscope, as read at one pixel on the CCD ($k$), is an integral over the area of one pixel. Inside the integral is the probability ($f(\rho')$) of an electron landing at position $\rho'$ on the detector given the interaction of the beam with the sample, multiplied by the probability ($h(\rho, \rho')$) of detecting an electron at location $\rho$ if the electron arrives at position $\rho'$ on the detector. The probability $h(\rho, \rho')$ of detecting an electron at one location after it hits the detector at another location is the point spread function (PSF: \ddref{PSF}).\\
		  & The second equation is the discretized version of the first. The signal $S(k)$ is the sum over all pixels $k'$ of the probability ($f(k')$) of an electron hitting pixel $k'$ multiplied by the probability ($h(k, k')$) of detecting an electron at $k$ after it hits pixel $k'$.\\
		  \hline
		  Source & \cite{zuo_electron_2000}\\
		  \hline
		  Ref.\ By & \tref{intensity} \ddref{Spectrum} \ddref{PSF}\\
		  \hline
	\end{tabular}
\end{minipage}\\

~\newline

\subsubsection{General Definitions}\label{sec_gendef}

This section provides a definition beneficial to understanding the data definitions.

%GD1
~\newline

\noindent
\begin{minipage}{\textwidth}
	\renewcommand*{\arraystretch}{1.5}
	\begin{tabular}{| p{\colAwidth} | p{\colBwidth}|}
		\hline
		\rowcolor[gray]{0.9}
		Number& GD\refstepcounter{defnum}\thedefnum \label{grid}\\
		\hline
		Label & Scanning grid  \\
		\hline
		Units& \si{\nano\metre}\\
		\hline
		Equation& $P(x,y) = \{\langle x, y \rangle \in A^2 \mid x \in \{0..X\}, y \in \{0..Y\} \}$\\
		\hline
		Description & $P(x,y)$ is a set of position coordinates describing the possible locations of the beam in two spatial coordinates $(x, y)$ during a raster scan across the sample in a rectangular grid pattern across the area on the sample, $A^2$. The limits on $(x,y)$ are set by the operator on the instrument, ranging from 0 to the maximum $(X,Y)$.
		\\
		  \hline
		  Ref.\ By & \ddref{SI}\\
		  \hline
	\end{tabular}
\end{minipage}\\

\subsubsection{Data Definitions}\label{sec_datadef}

This section collects and defines the data types needed to build the instance
models.

% DD1
~\newline

\noindent
\begin{minipage}{\textwidth}
	\renewcommand*{\arraystretch}{1.5}
	\begin{tabular}{| p{\colAwidth} | p{\colBwidth}|}
		\hline
		\rowcolor[gray]{0.9}
		Number& DD\refstepcounter{datadefnum}\thedatadefnum \label{Spectrum}\\
		\hline
		Label& \bf Spectrum\\
		\hline
		Symbol & $I(E)$\\
		\hline
		Units & Electron counts (EELS)\\
		& Photon counts (CL)\\
		& or arbitrary units (a.u.) for EELS or CL\\
		  \hline
		  Equation & $E = f(k)$\\
		  & $I(E) = \zeta(k=0..K)$\\
		  \hline
		  Description & Each pixel ($k$) on the spectrometer CCD has an energy loss (EELS) or wavelength (CL) value associated with it ($E$), obtained from the spectrometer acquisition settings (denoted here by $f(k)$), and a collected signal ($\zeta(k)$, \tref{signal}). The intensity of the spectrum ($I(E)$) is obtained from the collected signal over the whole CCD, from the 0th pixel to the final ($K$th) pixel.\\
		  \hline
		  Sources & \cite{egerton_introduction_2011} \\
		  \hline
		  Ref.\ By & \tref{signal}, \ddref{SI}, \ddref{PSF}, \iref{normalization}\\
		  \hline
	\end{tabular}
\end{minipage}\\

% DD2
~\newline

\noindent
\begin{minipage}{\textwidth}
\renewcommand*{\arraystretch}{1.5}
\begin{tabular}{| p{\colAwidth} | p{\colBwidth}|}
	\hline
	\rowcolor[gray]{0.9}
	Number& DD\refstepcounter{datadefnum}\thedatadefnum \label{SI}\\
	\hline
	Label& \bf Spectrum Image\\
	\hline
	Symbol &$I(x, y, E)$\\
	\hline
	Units & Electron counts (EELS)\\
	& Photons (CL)\\
	& or arbitrary units (a.u.) for EELS or CL\\
	\hline
	Equation& $I(x, y, E): \forall \langle x, y \rangle \in P(x,y), \exists I(x,y,E) \in \mathbb{R}$\\
	\hline
	Description & $I(x, y, E)$ is a dataset composed of Spectra (\ddref{Spectrum}) collected by the spectrometer detector at each value of $P(x,y)$ (\dref{grid}).
	\\
	\hline
	Sources&~\cite{jeanguillaume_spectrum-image:_1989}  \\
	\hline
	Ref.\ By & \ddref{PSF}, \iref{normalization}\\
	\hline
\end{tabular}
\end{minipage}\\

~\newline

\noindent
\begin{minipage}{\textwidth}
	\renewcommand*{\arraystretch}{1.5}
	\begin{tabular}{| p{\colAwidth} | p{\colBwidth}|}
		\hline
		\rowcolor[gray]{0.9}
		Number& DD\refstepcounter{datadefnum}\thedatadefnum \label{PSF}\\
		\hline
		Label& \bf Point Spread Function\\
		\hline
		Symbol &$I_{PSF}(E)$\\
		\hline
		Units & Electron counts or arbitrary units (a.u.) (EELS)\\
		  \hline
		  Equation&$I(E) = \zeta(k={0..K}) = g(k) S'(k) + b(k) + N(k)$\\
		  \hline
		  Description & 
		               $I_{PSF}(E)$ is a reference spectrum ($I(E)$, \ddref{Spectrum}) representing the effect of the point spread function (see \tref{signal}) on the collected spectra in the spectrum image (\ddref{SI}). It is a spectrum collected, ideally, with no interaction with a sample; the variables in the equation are defined as in \tref{intensity}, with the exception of $S'(k)$, which is an example of $S(k)$ with no sample interaction with the beam.
		  \\
		  \hline
		  Sources&~\cite{zuo_electron_2000, jeanguillaume_spectrum-image:_1989, gloter_improving_2003}  \\
		  \hline
		  Ref.\ By & \tref{signal}\\
		  \hline
	\end{tabular}
\end{minipage}\\

\subsubsection{Instance Models} \label{sec_instance}    

This section transforms the problem defined in Section~\ref{Sec_pd} into 
one which is expressed in mathematical terms. It uses concrete symbols defined 
in Section~\ref{sec_datadef} to replace the abstract symbols in the models 
identified in Sections~\ref{sec_theoretical} and~\ref{sec_gendef}.

The data processing goal \gsref{G_Processing} is solved by the following instance models (\iref{normalization}, \iref{deconvolution}, \iref{background} \iref{gain}).

~\newline

%Instance Model 1

\noindent
\begin{minipage}{\textwidth}
	\renewcommand*{\arraystretch}{1.5}
	\begin{tabular}{| p{\colAwidth} | p{\colBwidth}|}
		  \hline
		  \rowcolor[gray]{0.9}
		  Number& IM\refstepcounter{instnum}\theinstnum \label{normalization}\\
		  \hline
		  Label& \bf Normalization to the integral\\
		  \hline
		  Input& $k_1$  is the index of beginning of spectrum range (spectrum axis), user input\\
		  & $k_2$ is the index of end of spectrum range (spectrum axis), user input\\
		  & $I(E_k)$ is the 3D spectrum image, user input\\
		  & The input is constrained such that $k_1 >= 0$, and $k_2 <= N$\\
		  \hline
		  Output& $I_{norm}(E_k)=\frac{I(E_k)}{\sum_{E_{k=k_1}}^{E_{k=k_2}} I(E_k)}$\\
		  \hline
		  Description&$I(E_k)$ is a spectrum (\ddref{Spectrum}), user input\\
		  &$k_1$: Index of beginning of spectrum range (spectrum axis), user input\\
		  &$k_2$: Index of end of spectrum range (spectrum axis), user input\\
		  &$K$: Last index along the spectral axis\\
		  &$x$: Location along first spatial axis\\
		  &$y$: Location along second spatial axis\\
		  &$I_{norm}(E_k)$: Spectrum normalized along the spectral axis to the integral defined by a user\\
		  & Note that this algorithm can be applied to a 3D spectrum image (\ddref{SI}) by applying the algorithm to each $(x,y)$ pixel independently.\\
		  \hline
		  Sources & -- \\
		  \hline
		  Ref.\ By & \\
		  \hline
	\end{tabular}
\end{minipage}\\

~\newline

%Instance Model 2

\noindent
\begin{minipage}{\textwidth}
	\renewcommand*{\arraystretch}{1.5}
	\begin{tabular}{| p{\colAwidth} | p{\colBwidth}|}
		\hline
		\rowcolor[gray]{0.9}
		Number & IM\refstepcounter{instnum}\theinstnum \label{deconvolution}\\
		\hline
		Label & \bf Richardson-Lucy Deconvolution\\
		\hline
		Input& $I_{PSF}(E)$ is the point spread function of the instrument (see \ddref{PSF})\\
		& $I_{real}^0(E)$ is the initial guess for the ``real'' spectrum (\ddref{Spectrum})\\
		& $I_{measured}(E)$ is the measured spectrum, as obtained from the spectrometer software (\ddref{Spectrum})\\
		& $R$ is the total (non-negative integer) number of iterations of the deconvolution algorithm applied to the spectrum \\
		& $c$ is the number of the current iteration (at iteration 0, c = 0)\\
		& $i$, $j$, $l$ are each indices of pixels in the spectrum. Three different variables are used for the pixel index to make the effect of the summations clear.\\
		\hline
		Equation & $I_{real (j)}^{c+1}(E)=I_{real (j)}^c(E)\sum_i{\frac{I_{PSF}(E)I_{measured}(E)}{\sum_l{I_{PSF}(E)I_{real (l)}^c(E)}}}, while\ c < R$\\
		\hline
		Output& $I_{deconvolved}(E_k)=I_{real (j)}^{R}(E)$\\
		\hline
		Description & The purpose of the RL deconvolution algorithm is to separate the effects of the spectrometer point spread function from the ``real'' signal of the sample. \textit{I.e.} in \tref{signal}, the signal is described as the convolution of the point spread function with the signal from the microscope. Deconvolution is usually run after normalization of the spectra \iref{normalization} to eliminate effects of changing beam current.\\
		& This algorithm can also  be expanded to apply to the 3D spectrum image (\ddref{SI})) by applying it at every $(x,y)$ pixel in the spectrum image.\\
		\hline
		Sources&~\cite{gloter_improving_2003, bellido_toward_2014} \ \\
		\hline
		Ref.\ By & --\\
		\hline
	\end{tabular}
\end{minipage}\\

~\newline

%Instance Model 3

\noindent
\begin{minipage}{\textwidth}
	\renewcommand*{\arraystretch}{1.5}
	\begin{tabular}{| p{\colAwidth} | p{\colBwidth}|}
		\hline
		\rowcolor[gray]{0.9}
		Number& IM\refstepcounter{instnum}\theinstnum \label{background}\\
		\hline
		Label& \bf Background subtraction\\
		\hline
		Input & $I_{collected}$ is the spectrum as collected by the spectrometer.\\
		& $I_{background}(E)$ is a spectrum representing the background to be subtracted (this could be associated with the dark signal, or with the signal coming from unwanted, but unavoidable sources: \textit{e.g.} outside noise, substrate signal...)\\
		\hline
		Equation & $I_{sample}=I_{collected}-I_{background}$\\
		\hline
		Output& $I_{sample}(E)$\\
		\hline
		Description & This model addresses the removal of background contributions to the signal ($b(k)$ in \tref{intensity}), where $b(k)$ is transformed to a spectrum (\ddref{Spectrum}) as a function of energy.\\
		& The background spectrum must be of the same dimensions as the spectrum it is to be removed from. For the spectrum image, the background spectrum may be applied to each pixel.\\
		\hline
		Sources & -- \\
		\hline
		Ref.\ By & --\\
		\hline
	\end{tabular}
\end{minipage}\\

~\newline

%Instance Model 4

\noindent
\begin{minipage}{\textwidth}
	\renewcommand*{\arraystretch}{1.5}
	\begin{tabular}{| p{\colAwidth} | p{\colBwidth}|}
		\hline
		\rowcolor[gray]{0.9}
		Number& IM\refstepcounter{instnum}\theinstnum \label{gain}\\
		\hline
		Label& \bf Gain correction\\
		\hline
		Input & $I_{collected}$ is the spectrum (\ddref{Spectrum}) of the signal as collected by the spectrometer (see \tref{intensity}).\\
		& $g(E)$ is the gain ``spectrum'' of the spectrometer $g(k)$ transformed into a function of energy (\ddref{Spectrum})\\
		\hline
		Equation & $I_{corrected}(E)=\frac{I_{collected}(E)}{g_{E}}$\\
		\hline
		Output& $I_{corrected}(E)$ is the spectrum after the gain correction from the spectrometer CCD is applied.\\
		\hline
		Description & This model addresses the removal of the gain ($g(k)$ in \tref{intensity}) from the collected signal, where $g(k)$ is transformed to a ``spectrum'' (\ddref{Spectrum}) as a function of energy.\\
		\hline
		Sources & --\\
		\hline
		Ref.\ By & --\\
		\hline
	\end{tabular}
\end{minipage}\\

\subsubsection{Data Constraints} \label{sec_DataConstraints}    
This section details the constraints on the data that the software must process, including the input, processing steps, and output from the software. Physical constraints based on the expectations of the dataset are left out to allow the user more freedom in the input.

\begin{itemize}
	\item The input spectrum image (\ddref{SI}) must be a 3D structure, or a 3D structure contained within a .dm3 or .h5 file;
	\item The user input number of iterations to use for the deconvolution algorithm must be an integer number greater than or equal to 0;
	\item For the normalization model, the user input of the number of bins to normalize must not be empty;
	\item The user input of the background signal (\iref{background}) must be of the same length along the spectral axis as the spectrum image it will be applied to;
	\item The user input of the gain signal (\iref{gain}) must be of the same length along the spectral axis as the spectrum image it will be applied to;
	\item The normalization ({\iref{normalization}}) and deconvolution ({\iref{deconvolution}}) data processing algorithms both include a division by experimentally-derived values. The denominator in these steps must not be 0.
\end{itemize}

\subsubsection{Properties of a Correct Solution} \label{sec_CorrectSolution}

\noindent
A correct solution must be acceptable to a user experienced with EELS and/or CL data processing, as is relevant to the EELS/CL data being processed.

\section{Requirements}

This section provides the functional requirements, the business tasks that the
software is expected to complete, and the nonfunctional requirements, the
qualities that the software is expected to exhibit.

\subsection{Functional Requirements}

\noindent \begin{itemize}

	\item[R\refstepcounter{reqnum}\thereqnum \label{R_SI_inputs}:] Accept and read the following as Spectrum Image inputs:
	
	\begin{itemize}
		\item 3D data array (eg, already stored in computer memory)
		\item File in format *.dm3 containing 3D data array
		\item File in format *.h5 containing 3D data array
	\end{itemize}
	
	\item[R\refstepcounter{reqnum}\thereqnum \label{R_spectrum_inputs}:] Accept and read the following as Spectrum inputs:
	
	\begin{itemize}
		\item 1D data array
		\item File containing 1D data array in *.csv format
	\end{itemize}

	\item[R\refstepcounter{reqnum}\thereqnum \label{R_Input_dimension}:] Verify that all data inputs are of the correct dimensionality and composed of Real numbers
	
	\item[R\refstepcounter{reqnum}\thereqnum \label{R_SI_slicing}:] Accept user input to select a spectral range and extract (x,y) slices averaged over the selected spectral range and display the (x,y) slice as an image. The software should also export this image to an image file, as desired by the user.
	
	\item[R\refstepcounter{reqnum}\thereqnum \label{R_SI_area}:] Accept user input to define an area on an (x,y) image display and extract a spectrum averaged over selected pixels. The software should also export this spectrum as a *.csv file, as desired by the user.
	
	\item[R\refstepcounter{reqnum}\thereqnum \label{R_deconvolution}:] Given a 1D spectrum array and an integer number, the software should perform that number of deconvolution iterations on a 3D EELS dataset using the 1D spectrum array as a reference of the system response. The software should display the output of the deconvolution for navigation by the user. Output of the deconvolution algorithm will be validated by an expert user. 
	
	\item[R\refstepcounter{reqnum}\thereqnum \label{R_normalization}:] The software should be able to normalize a 3D spectrum image upon user command: either to an integrated portion of a chosen range along the spectral axis or to a single chosen channel.
	
	\item[R\refstepcounter{reqnum}\thereqnum \label{R_background}:] The software should be able to perform a background subtraction, given the appropriate inputs of a spectrum or spectrum image and a background reference spectrum.
	
	\item[R\refstepcounter{reqnum}\thereqnum \label{R_gain}:] The software should be able to perform a gain correction, given the appropriate inputs of a spectrum or spectrum image and a gain reference spectrum.
\end{itemize}

\subsection{Nonfunctional Requirements}

The nonfunctional priorities for the software are the useability, speed, maintainability, expandability, and understandability. The user must be able to easily use the software to extract the data that they want and do the processing operations that they want, given the user characteristics defined elsewhere. In addition, a more advanced user may wish to add their own functions into the software data processing algorithms; the software should be written in such a way to make this simple and understandable. The speed of performance is of interest in the interactive display of the 3D datasets and in the data processing operations, which can be computationally heavy with large datasets. To improve the software over time and add new functionality as the data processing field expands, the software must be both maintainable and understandable by the original programmer and future programmers. A user may wish to perform their own tests of the software functions, emphasizing the need to have transparent and understandable software. To reach a wide user base, the program should be usable on many different operating systems. The nonfunctional requirements are listed below:

\begin{itemize}
	\item The software should be maintainable by the original programmer or future programmers to keep up to date with advances in data processing practices;
	\item The software should allow the addition of more data processing functions as required by an advanced user experienced in programming;
	\item The software should not display significant lag when interacting with the user, except in the case of data processing steps, which may be computationally expensive;
	\item Use of the interactive display and of data processing functions should be intuitive for a user experienced with the processing techniques for 3D datasets;
	\item The coding practices for the software should be open and transparent to facilitate inspection by an experienced user to encourage trust in the data processing steps performed;
	\item The display for the user to interact with should be readable: \textit{i.e.} the text should be large enough to read by a user with average eyesight, with high contrast against the background for visibility;
	\item The colours used in the display should be clearly distinguishable from each other;
	\item The software should function on multiple operating systems, including Windows, Linux, and MacOS, in a laptop or desktop environment.
\end{itemize}

\section{Likely Changes}
	This section details some changes which are likely to be made to the software once the initial requirements are met, in the interests of continuous improvement of the software's capabilities.
	\noindent \begin{itemize}
		\item[LC\refstepcounter{lcnum}\thelcnum\label{LC_identicalPSF}:] A PSF unique to each pixel in the spectrum image (\ddref{SI}) will be used instead of assuming one PSF is valid for all pixels within a spectrum image (\aref{EELS_PSF_variability})
		\item[LC\refstepcounter{lcnum}\thelcnum\label{LC_identicalPSF}:] Cosmic rays appear as high intensity single pixel spikes in a spectrum and can be removed via 3D image filtering techniques. A future change will implement this filtering option for the user. 
	\end{itemize}

\section{Traceability Matrices and Graphs}

The purpose of the traceability matrices is to provide easy references on what
has to be additionally modified if a certain component is changed.  Every time a
component is changed, the items in the column of that component that are marked
with an ``X'' may have to be modified as well.  Table~\ref{Table:trace} shows the
dependencies of theoretical models, general definitions, data definitions, and
instance models with each other. Table~\ref{Table:R_trace} shows the
dependencies of instance models, requirements, and data constraints on each
other. Table~\ref{Table:A_trace} shows the dependencies of theoretical models,
general definitions, data definitions, instance models, and likely changes on
the assumptions.

\begin{table}[H]
	\centering
	\begin{tabular}{|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|}
		\hline
			& \aref{EELS_System_Response}& \aref{EELS_PSF_variability}& \aref{EELS_Intensity_Fluctuations}& \aref{CL_Background}& \aref{CL_System_Response}\\
		\hline
		\tref{intensity}     &  &  &  & X& X\\ \hline
		\tref{signal}        & X&  & X&  &  \\ \hline
		\dref{grid}          &  & X&  &  &  \\ \hline
		\ddref{Spectrum}     & X&  &  &  &  \\ \hline
		\ddref{SI}           & X& X&  &  &  \\ \hline
		\ddref{PSF}          & X& X&  &  &  \\ \hline
		\iref{normalization} &  &  & X&  &  \\ \hline
		\iref{deconvolution} & X& X&  &  &  \\ \hline
		\iref{background}    &  &  &  & X&  \\ \hline
		\iref{gain}          &  &  &  &  & X\\ \hline
	\end{tabular}
	\caption{Traceability Matrix Showing the Connections Between Assumptions and Other Items}
	\label{Table:A_trace}
\end{table}

\begin{table}[H]
	\centering
	\begin{tabular}{|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|}
		\hline 
		& \tref{intensity} & \tref{signal} & \dref{grid} & \ddref{Spectrum}& \ddref{SI} & \ddref{PSF}& \iref{normalization}& \iref{deconvolution}& \iref{background}& \iref{gain} \\
		\hline
		\tref{intensity}     &  & X&  &  &  &  &  &  & X& X\\ \hline
		\tref{signal}        &  &  &  &  &  &  &  &  &  &  \\ \hline
		\dref{grid}          &  &  &  &  &  &  &  &  &  &  \\ \hline
		\ddref{Spectrum}     & X&  &  &  &  &  &  &  & X&  \\ \hline
		\ddref{SI}           &  &  & X& X&  &  &  &  &  &  \\ \hline
		\ddref{PSF}          & X&  &  & X&  &  &  & X&  &  \\ \hline
		\iref{normalization} &  & X&  &  &  &  &  &  &  &  \\ \hline
		\iref{deconvolution} & X& X&  &  &  & X&  &  &  &  \\ \hline
		\iref{background}    & X&  &  &  &  &  &  &  &  &  \\ \hline
		\iref{gain}          & X&  &  &  &  &  &  &  &  &  \\
		\hline
	\end{tabular}
	\caption{Traceability Matrix Showing the Connections Between Items of Different Sections}
	\label{Table:trace}
\end{table}

\begin{table}[H]
\centering
\begin{tabular}{|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|}
\hline
	& \iref{normalization}& \iref{deconvolution}& \iref{background}& \iref{gain}& \ref{sec_DataConstraints}& \rref{R_SI_inputs}& \rref{R_spectrum_inputs} & \rref{R_Input_dimension} & \rref{R_SI_slicing} & \rref{R_SI_area} & \rref{R_deconvolution} & \rref{R_normalization} & \rref{R_background} & \rref{R_gain}\\
\hline
\iref{normalization}     &  &  &  &  &  & X&  &  &  &  &  & X&  &  \\ \hline
\iref{deconvolution}     & X&  &  &  &  & X&  & X&  &  & X&  &  &  \\ \hline
\iref{background}        &  &  &  &  &  & X& X& X&  &  &  &  & X&  \\ \hline
\iref{gain}              &  &  &  &  &  & X& X& X&  &  &  &  &  & X\\ \hline
\rref{R_SI_inputs}       &  &  &  &  & X& X&  & X&  & X&  &  &  &  \\ \hline
\rref{R_spectrum_inputs} &  &  &  &  & X&  &  & X&  &  & X&  &  &  \\ \hline
\rref{R_Input_dimension} &  &  &  &  & X& X& X&  & X& X&  &  & X& X\\ \hline
\rref{R_SI_slicing}      &  &  &  &  &  &  &  &  &  &  &  &  &  &  \\ \hline
\rref{R_SI_area}         &  &  &  &  &  &  &  &  &  &  &  &  &  &  \\ \hline 
\rref{R_deconvolution}   & X& X&  &  &  &  & X&  &  &  &  & X&  &  \\ \hline
\rref{R_normalization}   & X&  &  &  &  &  &  &  &  &  &  &  &  &  \\ \hline
\rref{R_background}      &  &  & X&  &  &  & X&  &  &  &  &  &  &  \\ \hline
\rref{R_gain}            &  &  &  & X&  &  & X&  &  &  &  &  &  &  \\ \hline

\hline
\end{tabular}
\caption{Traceability Matrix Showing the Connections Between Requirements and Instance Models}
\label{Table:R_trace}
\end{table}

% \begin{figure}[h!]
% 	\begin{center}
% 		%\rotatebox{-90}
% 		{
% 			\includegraphics[width=\textwidth]{ATrace.png}
% 		}
% 		\caption{\label{Fig_ATrace} Traceability Matrix Showing the Connections Between Items of Different Sections}
% 	\end{center}
% \end{figure}


% \begin{figure}[h!]
% 	\begin{center}
% 		%\rotatebox{-90}
% 		{
% 			\includegraphics[width=0.7\textwidth]{RTrace.png}
% 		}
% 		\caption{\label{Fig_RTrace} Traceability Matrix Showing the Connections Between Requirements, Instance Models, and Data Constraints}
% 	\end{center}
% \end{figure}

\newpage

\bibliography {SRS}

\newpage

\section{Appendix}

\wss{Your report may require an appendix.  For instance, this is a good point to
show the values of the symbolic parameters introduced in the report.}

\subsection{Symbolic Parameters}

\wss{The definition of the requirements will likely call for SYMBOLIC\_CONSTANTS.
Their values are defined in this section for easy maintenance.}

\end{document}