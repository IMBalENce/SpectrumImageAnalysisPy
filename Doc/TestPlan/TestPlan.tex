\documentclass[12pt, titlepage]{article}

\usepackage{booktabs}
\usepackage{siunitx}
\usepackage{tabularx}
\usepackage{xr-hyper}

\usepackage{hyperref}
\hypersetup{
    colorlinks,
    citecolor=black,
    filecolor=black,
    linkcolor=red,
    urlcolor=blue
}

\externaldocument{../SRS/SRS}

\newcommand{\progname}{SpectrumImageAnalysisPy}
\newcommand{\rthereqnum}{P\thereqnum}
\newcommand{\ddref}[1]{DD\ref{#1}}

\input{../Comments}

\begin{document}
\bibliographystyle{ieeetr}
\title{SpectrumImageAnalysisPy} 
\author{Isobel Bicket}
\date{\today}
	
\maketitle

\pagenumbering{roman}

\section{Revision History}

\begin{tabularx}{\textwidth}{p{4cm}p{2cm}X}
\toprule {\bf Date} & {\bf Version} & {\bf Notes}\\
\midrule
\today & 1.0 & Initial draft\\
\bottomrule
\end{tabularx}

~\newpage

\section{Symbols, Abbreviations and Acronyms}

\renewcommand{\arraystretch}{1.2}
\begin{tabular}{l l} 
  \toprule		
  \textbf{symbol} & \textbf{description}\\
  \midrule 
  RMS & Root Mean Square\\
  T & Test\\
  \bottomrule
\end{tabular}\\

\wss{symbols, abbreviations or acronyms -- you can reference the SRS tables if needed}

\newpage

\tableofcontents

\listoftables

\listoffigures

\newpage

\pagenumbering{arabic}

This document outlines the different tests and assessment tools which will be used for assessing the performance of \progname{}. The testing will be done to build confidence in the performance of the program and allow the end user to use it with more assurity that it is behaving correctly and any artifacts seen in the data are either a known result of the program, or independent of the use of \progname{} to process the data.

\section{General Information}
The testing outlined in this document gives valuable contributions to the level of trust in the performance of the software. Not only will testing the software build confidence that it is performing correctly, but the results of the tests will also tell the user what to expect when running the software, for instance in terms of performance milestones. Testing not only ensures that the software will, within predictive power, fulfill its \hyperref[subsec:FR]{functional requirements}, but gives the progress and effectiveness of the software in fulfulling the \hyperref[subsec:NfR]{non-functional requirements}.

\subsection{Purpose}
The purpose of this document is to describe the tests which will be carried out on \progname{} to verify that it meets the requirements described in the \hyperref[doc:SRS]{SRS}.

\subsection{Scope}
This document will cover the verification plan for testing the software \progname{}, including the system tests towards verifying that the software meets the functional and non-functional requirements; and the unit tests, of which a non-exhaustive list is given. The document does not cover the validation of the software algorithms. 

\subsection{Overview of Document}
 It begins by outlining the structure of the document, followed by an overview of the testing arrangements. Specific details follow on the tests which will be performed to test whether or not \progname{} satisfies the \hyperref[subsec:FuncReqTest]{functional} and \hyperref[subsec:NonfuncReqTest]{non-functional} requirements, as well as details of the unit tests which will be written. The unit tests themselves may satisfy some of the functional requirements without needing system testing, these will be detailed under \hyperref[sec:UnitTest]{Unit Testing Plan} as appropriate.

\section{Plan}
This section details the plan to be followed when testing the software, including those involved in the testing, the testing approach, and the verification tools which will be used.
	
\subsection{Software Description}
The software, \progname{}, is designed as a data analysis tool for electron energy loss spectroscopy and cathodoluminescence spectrum imaging data. It provides several data processing routines to the user and a graphical user interface to navigate the 3D data set and export desired spectra or image slices. The requirements and expectations for \progname{} are detailed in the \hyperref[doc:SRS]{Software Requirements Specification}.

\subsection{Test Team}
The test team has one member: Isobel Bicket.

\subsection{Automated Testing Approach}

Unit testing will be performed on the functions within the code, as an automated task to be done with every update of the code. The running of automated tests also provides regression testing and integration testing of new features and updates. The goal of testing is 100\% code coverage.\\
The testing plan will not cover testing of the GUI, only the functions called by the GUI after user interaction. Proper user interfacing is expected to be done by the library used to build the GUI.\\

\subsection{Verification Tools}

The following verification tools will be used
\begin{itemize}
	\item Python unittest library: for performing unit tests on the code;
	\item Python coverage library: to determine the coverage of the tests;
	\item Deconvo.m: a Richardson-Lucy deconvolution algorithm implementation in Matlab, written by Dr. E.P. Bellido \cite{bellido_toward_2014};
	\item Python HypersPy library: a Python-based library for EELS and EDX spectrum processing \cite{francisco_de_la_pena_2017_583693}.
\end{itemize}
\wss{Thoughts on what tools to use, such as the following: unit testing
  framework, valgrind, static analyzer, make, continuous integration, test
  coverage tool, etc.}

\subsection{Non-Testing Based Verification}

The following non-testing based verification methods will be used to assess the performance of \progname{}

\begin{itemize}
	\item Code review: a detailed code review will be performed by an external party and feedback provided;
	\item User survey: a group of qualified users will be asked to process a sample dataset using the software and will be polled on their user experience.
\end{itemize}

\wss{List any approaches like code inspection, code walkthrough, symbolic
  execution etc.  Enter not applicable if that is the case.}

\section{System Test Description}
\label{sec:SysTest}
	
\subsection{Tests for Functional Requirements}
\label{subsec:FuncReqTest}

\subsubsection{Deconvolution}
		
\paragraph{}

\begin{enumerate}

\item{Deconvolution error - blank PSF}

Type: Functional, Dynamic
					
Initial State: Spectrum loaded into \progname{}.

Input: A known spectrum (for instance, the data used in the paper by Bellido \textit{et al} \cite{bellido_toward_2014}, if it is available from the author). Otherwise a spectrum will be simulated. A range of integers will be used as input for the number of deconvolution iterations. The input of a point spread function to the deconvolution will be an array of ones.

Output: A series of spectra deconvolved using the range of iterations given in the input, and a plot of the RMS error vs the number of iterations used.
					
How test will be performed: A series of deconvolutions will be run on the artificial spectrum, with varying numbers of iterations to produce a set of deconvolved spectra. The difference between the deconvolved spectra and the original simulated spectrum will be calculated and the RMS error plotted as a function of number of iterations. Ideally the deconvolved spectra will be identical to the input spectrum, because we are using a null function as the PSF reference.\\


\item{Deconvolution error}

Type: Functional, Dynamic
					
Initial State: Spectrum loaded into \progname{}.

Input: A known spectrum convolved with a broadening function (for instance, the data used in the paper by Bellido \textit{et al} \cite{bellido_toward_2014}, if it is available from the author). Otherwise a spectrum will be simulated and convolved with a broadening function (such as a Lorentzian peak, a Gaussian peak, or an experimental point spread function). A range of integers will be used as input for the number of deconvolution iterations. The broadening function itself is also an input to the deconvolution.

Output: A series of spectra deconvolved using the range of iterations given in the input, and a plot of the RMS error vs the number of iterations used.
					
How test will be performed: A series of deconvolutions will be run on the artificially broadened spectrum, using the broadening function as the point spread function, with varying numbers of iterations to produce a set of deconvolved spectra. The difference between the deconvolved spectra and the original simulated spectrum (before convolution with a broadening function) will be calculated and the root mean square error plotted as a function of number of iterations.\\

\an{test RL deconvolution algorithm - SNR vs number iterations}
\an{test RL deconvolution algorithm - deviation from 'real' spectrum (simulated) vs number iterations (compare to 'real' spectrum)}
\an{test RL deconvolution - time vs SI size, time vs number iterations (parallel processing) - non-functional req's}

\end{enumerate}

\paragraph{}

\begin{enumerate}

\item{}

Type: Functional, Dynamic, Manual, Static etc.
					
Initial State: \ddref{Spectrum}
					
Input: 
					
Output: 
					
How test will be performed: 



\end{enumerate}


\subsubsection{Area of Testing2}

...

\subsection{Tests for Nonfunctional Requirements}
\label{subsec:NonfuncReqTest}

\subsubsection{Area of Testing1}
		
\paragraph{Title for Test}

\begin{enumerate}

\item{test-id1\\}

Type: 
					
Initial State: 
					
Input/Condition: 
					
Output/Result: 
					
How test will be performed: 
					
\item{test-id2\\}

Type: Functional, Dynamic, Manual, Static etc.
					
Initial State: 
					
Input: 
					
Output: 
					
How test will be performed: 

\end{enumerate}

\subsubsection{Area of Testing2}

...

\subsection{Traceability Between Test Cases and Requirements}

% \section{Tests for Proof of Concept}

% \subsection{Area of Testing1}
		
% \paragraph{Title for Test}

% \begin{enumerate}

% \item{test-id1\\}

% Type: Functional, Dynamic, Manual, Static etc.
					
% Initial State: 
					
% Input: 
					
% Output: 
					
% How test will be performed: 
					
% \item{test-id2\\}

% Type: Functional, Dynamic, Manual, Static etc.
					
% Initial State: 

% Input: 
					
% Output: 
					
% How test will be performed: 

% \end{enumerate}

% \subsection{Area of Testing2}

% ...
				
\section{Unit Testing Plan}
\label{sec:UnitTest}

\subsection{Inputs}
		
\paragraph{Spectrum Image Input}

\begin{enumerate}

\item{SI Data array with energy range (EELS)}

Type: Functional, Dynamic, Unit

Initial State: None

Input: 3D data array, present in memory; use standard calibration variabilities\\
For example, the following values might be used to create an SI: 
\begin{itemize}
	\item $x = [0, 1]$
	\item $y = [0, 1]$
	\item $\text{Intensity} = \text{ones}(\text{size}(2,2,10))$
	\item $\text{x calibration} = 1\ \si{\nano\metre}/\text{pixel}$
	\item $\text{energy range} = \text{range}(0, 10)\ \si{\electronvolt}$
\end{itemize}

Output: Spectrum Image stored within \progname{}; the first and second axes should correspond to spatial dimensions, while the third axis should correspond to a spectral dimension.

How test will be performed: Create a 3D data array and attempt to initialize a spectrum image in \progname{}. No errors should be raised. The spectrum image axes should be read in the correct order (x, y, E), and the calibrations should be applied to the correct axes. Addresses \hyperref[R_SI_inputs]{Functional Requirement}.


\item{SI Data array with dispersion (EELS)}

Type: Functional, Dynamic, Unit

Initial State: None

Input: 3D data array, present in memory; use standard calibration variabilities\\
For example, the following values might be used to create an SI: 
\begin{itemize}
	\item $x = [0, 1]$
	\item $y = [0, 1]$
	\item $\text{Intensity} = \text{ones}(\text{size}(2,2,10))$
	\item $\text{x calibration} = 1\ \si{\nano\metre}/\text{pixel}$
	\item $\text{dispersion} = 0.01\ \si{\electronvolt}/\text{pixel}$
	\item $E(0) = -2\ \si{\electronvolt}$
\end{itemize}

Output: Spectrum Image stored within \progname{}; the first and second axes should correspond to spatial dimensions, while the third axis should correspond to a spectral dimension.

How test will be performed: Create a 3D data array and attempt to initialize a spectrum image in \progname{}. No errors should be raised. The spectrum image axes should be read in the correct order (x, y, E), and the calibrations should be applied to the correct axes.


\item{SI Data array with wavelength range (CL)}

Type: Functional, Dynamic, Unit

Initial State: None

Input: 3D data array, present in memory; use standard calibration variabilities\\
For example, the following values might be used to create an SI: 
\begin{itemize}
	\item $x = [0, 1]$
	\item $y = [0, 1]$
	\item $\text{Intensity} = \text{ones}(\text{size}(2,2,10))$
	\item $\text{x calibration} = 1\ \si{\nano\metre}/\text{pixel}$
	\item $\text{wavelength range} = \text{range}(0, 10)\ \si{\nano\metre}$
\end{itemize}

Output: Spectrum Image stored within \progname{}; the first and second axes should correspond to spatial dimensions, while the third axis should correspond to a spectral dimension.

How test will be performed: Create a 3D data array and attempt to initialize a spectrum image in \progname{}. No errors should be raised. The spectrum image axes should be read in the correct order (x, y, E), and the calibrations should be applied to the correct axes.


\item{SI .dm3 file}

Type: Functional, Dynamic, Unit

Initial State: None

Input: A .dm3 file, containing a fabricated spectrum image. The .dm3 file will be created using Digital Micrograph (Gatan Microscopy Suite Software) software \cite{noauthor_gatan_nodate} with the following parameters:
\begin{itemize}
	\item $x = [0, 1]$
	\item $y = [0, 1]$
	\item $\text{Intensity} = \text{ones}(\text{size}(2,2,10))$
	\item $\text{x calibration} = 1\ \si{\nano\metre}/\text{pixel}$
	\item $\text{dispersion} = 0.01\ \si{\electronvolt}/\text{pixel}$
	\item $E(0) = -2\ \si{\electronvolt}$
\end{itemize}

Output: EELS Spectrum Image stored within \progname{}, with metadata assigned to appropriate values

How test will be performed: Read in the .dm3 file with \progname{}. Check that no errors are raised. Display the spectrum image to manually check that the data was read in correctly. Check spatial and spectral calibration to verify metadata was assigned correctly.

\an{There is a potential problem with the .dm3 file, since there are many version of Digital Micrograph out there and many different set-ups, all of which may format their .dm3 slightly differently. Not sure on the best way to test this, without asking several other labs for pieces of data (which are not usually shared readily) and trying out all of them.}

\item{SI .h5 file}

Type: Functional, Dynamic, Unit.

Initial State: None

Input: .h5 file, containing an acquired or fabricated spectrum image. The .h5 spectrum image file originates from Odemis software \cite{bv_odemis:_nodate}, it may be possible to fabricate a spectrum image using the scripting interface, using the following values for the calibration parameters, otherwise it may be necessary to use an acquired data file.

\begin{itemize}
	\item $x = [0, 1]$
	\item $y = [0, 1]$
	\item $\text{Intensity} = \text{ones}(\text{size}(2,2,10))$
	\item $\text{x calibration} = 1\ \si{\nano\metre}/\text{pixel}$
	\item $\text{wavelength range} = \text{range}(0, 10)\ \si{\nano\metre}$
\end{itemize}

Output: CL Spectrum Image stored within \progname, with metadata assigned to appropriate values.
					
How test will be performed: Read in the .h5 file with \progname{}. Check that no errors are raised. Check spatial and spectral calibration to verify metadata was assigned correctly.

\item{SI Data array with dispersion (EELS) - complex numbers}

Type: Functional, Dynamic, Unit

Initial State: None

Input: 3D data array, present in memory; use standard calibration variabilities\\
For example, the following values might be used to create an SI: 
\begin{itemize}
	\item $x = [0, 1]$
	\item $y = [0, 1]$
	\item $\text{Intensity} = \text{ones}(\text{size}(2,2,10)) + j * \text{ones}(\text{size}(2,2,10))$
	\item $\text{x calibration} = 1\ \si{\nano\metre}/\text{pixel}$
	\item $\text{dispersion} = 0.01\ \si{\electronvolt}/\text{pixel}$
	\item $E(0) = -2\ \si{\electronvolt}$
\end{itemize}

Output: Spectrum Image stored within \progname{}; the first and second axes should correspond to spatial dimensions, while the third axis should correspond to a spectral dimension.

How test will be performed: Create a 3D data array and attempt to initialize a spectrum image in \progname{}. No errors should be raised. The spectrum image axes should be read in the correct order (x, y, E), and the calibrations should be applied to the correct axes.

\end{enumerate}

\paragraph{Spectrum Input}

\begin{enumerate}

\item{Spectrum Data array}

Type: Functional, Dynamic, Unit.
					
Initial State: 
					
Input: 1D data array, present in memory. For example, the following data may be used to initialize a Spectrum:
\begin{itemize}
	\item $\text{intensity} = \text{ones}(\text{size}(10))\ \text{counts}$
	\item $\text{energy range} = \text{range}(0, 10)\ \si{\electronvolt}$
\end{itemize}

Output: Spectrum stored within \progname{}, with data assigned to appropriate values.
					
How test will be performed: Create a 1D data array and attempt to read it with \progname{}. No errors should be raised. The unit test will check that the intensity and energy range are assigned to the appropriate variables, as well as the spectral calibration.


\item{Spectrum .csv file}

Type: Functional, Dynamic, Unit.

Initial State: 

Input: .csv file, containing a 1D spectrum. The following data may be used to create a spectrum csv file:
\begin{itemize}
	\item $\text{Intensity} = \text{ones}(\text{size}(10))\ \text{counts}$
	\item $\text{energy range} = \text{range}(0, 10)\ \si{\electronvolt}$
\end{itemize}

Output: Spectrum stored within \progname{}, with data assigned to appropriate values

How test will be performed: A csv file containing 1D spectrum data will be imported. No errors should be raised. The unit test will check that the intensity and energy range are assigned to the appropriate variables, as well as the spectral calibration.


\item{Spectrum Data array - complex numbers}

Type: Functional, Dynamic, Unit.

Initial State: 

Input: 1D data array, present in memory. For example, the following data may be used to initialize a Spectrum:
\begin{itemize}
	\item $\text{energy values} = \text{ones}(\text{size}(10)) + j*\text{ones}(\text{size}(10))\ \text{counts}$
	\item $\text{energy range} = \text{range}(0, 10)\ \si{\electronvolt}$
\end{itemize}

Output: Error message - input must be real

How test will be performed: Create a 1D data array and attempt to read it with \progname{}. An error should be raised.


\item{Spectrum Data array - 2D array}

Type: Functional, Dynamic, Unit.

Initial State: 

Input: 2D data array, present in memory. For example, the following data may be used to initialize a Spectrum:
\begin{itemize}
	\item $\text{energy values} = \text{ones}(\text{size}(2, 2))\ \text{counts}$
	\item $\text{energy range} = \text{range}(0, 2)\ \si{\electronvolt}$
\end{itemize}

Output: Error message - input must be 1D

How test will be performed: Create a 1D data array and attempt to read it with \progname{}. An error should be raised.

\end{enumerate}

\paragraph{Energy range slicing}

The spectrum image to be used for these tests will be the same for all tests in this section and may, for example, consist of float values from 0 to 1, reshaped into the size (2,2,10), with an energy range from $0-10 \si{\electronvolt}$.

\begin{enumerate}

\item{Extract $(x,y)$ slice from spectrum}

Type: Functional, Dynamic, Unit

Initial State: Spectrum image exists in \progname{}.

Input: Two values within the spectrum range calibration values. For example, in a spectrum image with an energy range from $0-9\ \si{\electronvolt}$, the input values might be 5 and 7. the existing spectrum image must have different values of intensity at each pixel and each channel along the energy axis.

Output: An $(x,y)$ image averaged over the spectral range specified by the input to the test.

How test will be performed: Using a 3D dataset, such as those used in the Spectrum image 3D dataset unit test, the test will request the return value of an $(x,y)$ image averaged over the chosen spectral range. No errors should be raised. Check that the range averaged over is the same as the range selected.


\item{Extract $(x,y)$ slice from spectrum, slice less than any value in the energy range}

Type: Functional, Dynamic, Unit

Initial State: Spectrum image exists in \progname{}.

Input: Two values within the spectrum range calibration values. For example, in a spectrum image with an energy range from $0-9\ \si{\electronvolt}$, the input values might be -2 and 5. the existing spectrum image must have different values of intensity at each pixel and each channel along the energy axis.

Output: An $(x,y)$ image averaged over the spectral range specified by the input to the test and the minimum value of the energy range in the spectrum image.

How test will be performed: Using a 3D dataset, such as those used in the Spectrum image 3D dataset unit test, the test will request the return value of an $(x,y)$ image averaged over the chosen spectral range. No errors should be raised. Check that the range averaged over is the same as the range selected within the data limits.


\item{Extract $(x,y)$ slice from spectrum, slice more than any value in the energy range}

Type: Functional, Dynamic, Unit

Initial State: Spectrum image exists in \progname{}.

Input: Two values within the spectrum range calibration values. For example, in a spectrum image with an energy range from $0-9\ \si{\electronvolt}$, the input values might be 5 and 12. the existing spectrum image must have different values of intensity at each pixel and each channel along the energy axis.

Output: An $(x,y)$ image averaged over the spectral range specified by the input to the test and the maximum value of the energy range in the spectrum image.

How test will be performed: Using a 3D dataset, such as those used in the Spectrum image 3D dataset unit test, the test will request the return value of an $(x,y)$ image averaged over the chosen spectral range. No errors should be raised. Check that the range averaged over is the same as the range selected within the data limits.


\item{Extract $(x,y)$ slice from spectrum, slice completely outside the energy range}

Type: Functional, Dynamic, Unit

Initial State: Spectrum image exists in \progname{}.

Input: Two values within the spectrum range calibration values. For example, in a spectrum image with an energy range from $0-9\ \si{\electronvolt}$, the input values might be -5 and -2. the existing spectrum image must have different values of intensity at each pixel and each channel along the energy axis.

Output: A warning should be raised that the range selected is outside the range for which there is data available.

How test will be performed: Using a 3D dataset, such as those used in the Spectrum image 3D dataset unit test, the test will request the return value of an $(x,y)$ image averaged over the chosen spectral range. A warning should be raised and no image returned.


\item{Extract $(x,y)$ slice from spectrum, backwards slice}

Type: Functional, Dynamic, Unit

Initial State: Spectrum image exists in \progname{}.

Input: Two values within the spectrum range calibration values. For example, in a spectrum image with an energy range from $0-9\ \si{\electronvolt}$, the input values might be 7 and 5. the existing spectrum image must have different values of intensity at each pixel and each channel along the energy axis.

Output: An $(x,y)$ image averaged over the spectral range specified by the input to the test.

How test will be performed: Using a 3D dataset, such as those used in the Spectrum image 3D dataset unit test, the test will request the return value of an $(x,y)$ image averaged over the chosen spectral range (regardless of the order of selection, the program should behave exactly the same as if the input range was 5 to 7). No errors should be raised. Check that the range averaged over is the same as the range selected (ie, by knowing what data the spectrum image contains).

\end{enumerate}

\bibliography {TestPlan}

\newpage

\section{Appendix}

This is where you can place additional information.

\subsection{Symbolic Parameters}

The definition of the test cases will call for SYMBOLIC\_CONSTANTS.
Their values are defined in this section for easy maintenance.

\subsection{Usability Survey Questions?}

This is a section that would be appropriate for some teams.

\end{document}